<!DOCTYPE html> {% extends 'ms/home/initial/initial.html' %} {% block content %} {% load static %}
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <title>Категории</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script defer="" src="{% static 'ms/initial/categories/categories.js' %}" type="text/javascript"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <link href="{% static 'ms/initial/categories/categories.css' %}" media="screen" rel="stylesheet">
  <style>

  </style>
</head>

<body>
  <div class="button-container">
    <button class="btn btn-primary" id="createCategoryBtn">+ Создать категорию</button>
    <button class="btn btn-primary" id="openNewModalBtn" type="button">Фильтр категорий</button>

    <!-- Новое модальное окно -->
    <div aria-hidden="true" class="modal fade" id="newModal" style="z-index: 1091;" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Новое модальное окно</h5>
            <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
          </div>
          <div class="modal-body">
            <p>Выберите действие:</p>
            <!-- Три кнопки -->
            <button class="btn btn-outline-primary" id="btnAction1" onclick="openCategoryFilterModal1('range')">Фильтр по диапазону
            </button>
            <button class="btn btn-outline-primary" id="btnAction2" onclick="openCategoryFilterModal1('month')">Фильтр по месяцу
            </button>
            <button class="btn btn-outline-primary" id="btnAction3" onclick="openCategoryFilterModal1('year')">Фильтр по году
            </button>
          </div>
          <div class="modal-footer">
            <button class="btn btn-secondary" data-bs-dismiss="modal" type="button">Закрыть</button>
          </div>
        </div>
      </div>
    </div>
    <div aria-hidden="true" class="modal fade" id="filterCategoryModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Фильтр категорий</h5>
            <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
          </div>
          <div class="modal-body" id="filterCategoryContent">
            <!-- Динамический контент -->
          </div>
          <div class="modal-footer">
            <button class="btn btn-secondary" data-bs-dismiss="modal" type="button">Закрыть</button>
            <button class="btn btn-primary" onclick="applyCategoryFilter()" type="button">Применить</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="container mt-4">

    <!-- Диаграмма доходов -->
    <div class="diagrams-container">
      <div class="diagram active" id="incomeDiagram">
        <div class="donut-chart" onclick="swapDiagrams()" style="background:
                    {% if income_categories %}
                        conic-gradient(
                            {% for category in income_categories %}
                                {{ category.color }} {{ category.start_percentage }}% {{ category.end_percentage }}%{% if not forloop.last %}, {% endif %}
                            {% endfor %}
                        );
                    {% else %}
                        #ccc;
                    {% endif %};">
          <div class="chart-center-text">
            <div>Доходы: {{ total_income|default:"0" }}₽</div>
          </div>
          <div class="categories">
            {% for category in income_categorie %}
            <div class="category income-category" data-name="{{ category.name }}" onclick="openEditCategoryModal('{{ category.name }}')" style="background-color: {{ category.color }};">
              {{ category.name }}
              <div class="category-value">{{ category.value }}₽</div>
            </div>
            {% empty %}
            <div class="category income-category" style="background-color: #ccc;">
              Нет категорий для доходов
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
      <div class="diagram hidden" id="expenseDiagram">
        <div class="donut-chart" onclick="swapDiagrams()" style="background:
                    {% if expense_categories %}
                        conic-gradient(
                            {% for category in expense_categories %}
                                {{ category.color }} {{ category.start_percentage }}% {{ category.end_percentage }}%{% if not forloop.last %}, {% endif %}
                            {% endfor %}
                        );
                    {% else %}
                        #ccc;
                    {% endif %};">
          <div class="chart-center-text">
            <div>Расходы: {{ total_expenses|default:"0" }}₽</div>
          </div>
          <div class="categories">
            {% for category in expense_categorie %}
            <div class="category expense-category" data-name="{{ category.name }}" onclick="openEditCategoryModal('{{ category.name }}')" style="background-color: {{ category.color }};">
              {{ category.name }}
              <div class="category-value">{{ category.value }}₽</div>
            </div>
            {% empty %}
            <div class="category expense-category" style="background-color: #ccc;">
              Нет категорий для расходов
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>

    <!-- Модальное окно для добавления категории -->
    <div class="modal" id="createCategoryModal">
      <div class="modal-content">
        <span class="close" id="closeModal">&times;</span>
        <h2>Добавить новую категорию</h2>
        <form id="categoryForm" method="POST">
          {% csrf_token %}
          <label for="categoryName">Название категории:</label>
          <input id="categoryName" name="name" required type="text">
          <br>
          <br>

          <label for="categoryColor">Цвет:</label>
          <input id="categoryColor" name="color" required type="color">
          <br>
          <br>

          <label for="is_expense">Это расход?</label>
          <input id="is_expense" name="is_expense" type="checkbox">
          <br>

          <button type="submit">Добавить категорию</button>
        </form>
      </div>
    </div>

    <!-- Модальное окно для редактирования категории -->
    <div class="modal" id="editCategoryModal">
      <div class="modal-content">
        <span class="close" id="closeEditModal">&times;</span>
        <h2>Редактировать категорию</h2>
        <form id="editCategoryForm" method="POST">
          {% csrf_token %}
          <label for="editCategoryName">Название категории:</label>
          <input id="editCategoryName" name="name" required type="text">
          <br>
          <br>

          <label for="editCategoryColor">Цвет:</label>
          <input id="editCategoryColor" name="color" required type="color">
          <br>
          <br>

          <button id="saveCategoryBtn" type="submit">Сохранить изменения</button>
          <button id="deleteCategoryBtn" type="button">Удалить категорию</button>
        </form>
      </div>
    </div>
  </div>
</body>

</html>
{% endblock %}